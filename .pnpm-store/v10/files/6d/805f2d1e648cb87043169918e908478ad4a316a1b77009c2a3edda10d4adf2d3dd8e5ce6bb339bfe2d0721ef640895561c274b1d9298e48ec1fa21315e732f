function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
import { createFromIconfontCN, SearchOutlined, VerticalAlignTopOutlined } from '@ant-design/icons';
import { Input, Menu, Tooltip } from 'antd';
import classNames from 'classnames';
import { FormattedMessage, useIntl, useLocale } from 'dumi';
import { cloneDeep } from 'lodash-es';
import React, { useEffect, useRef, useState } from 'react';
import { filterTreeNode } from "../utils";
import styles from "./index.module.less";

// menu icon
var MenuIcon = createFromIconfontCN({
  scriptUrl: '//at.alicdn.com/t/font_470089_1lnym745udm.js' // generated by iconfont.cn
});
/**
 * DEMO 预览页面的菜单
 */
var ExampleSider = function ExampleSider(props) {
  var currentDemo = props.currentDemo,
    onDemoClicked = props.onDemoClicked,
    exampleTopics = props.exampleTopics;
  // 菜单栏展开keys
  var _useState = useState([]),
    _useState2 = _slicedToArray(_useState, 2),
    openKeys = _useState2[0],
    setOpenKeys = _useState2[1];
  var menuRef = useRef(null);

  // 初始化点击进来的示例按钮a的dom
  var _useState3 = useState(),
    _useState4 = _slicedToArray(_useState3, 2),
    aRef = _useState4[0],
    setARef = _useState4[1];

  // input 搜索框的value
  var _useState5 = useState(''),
    _useState6 = _slicedToArray(_useState5, 2),
    searchValue = _useState6[0],
    setSearchValue = _useState6[1];
  var locale = useLocale();
  var intl = useIntl();
  var getCurrentTopics = function getCurrentTopics() {
    var res = filterTreeNode({
      id: 'FAKE_ID',
      childrenKey: 'exampleTopics',
      title: {
        zh: 'FAKE_TITLE',
        en: 'FAKE_TITLE'
      },
      exampleTopics: cloneDeep(exampleTopics)
    }, searchValue, locale.id);
    return (res === null || res === void 0 ? void 0 : res.exampleTopics) || [];
  };

  // 初始化菜单栏展开keys
  useEffect(function () {
    var targetExample = currentDemo.targetExample,
      targetTopic = currentDemo.targetTopic;
    var keys = ["TOPIC-".concat(targetTopic === null || targetTopic === void 0 ? void 0 : targetTopic.id), "EXAMPLE-".concat(targetTopic.id, "-").concat(targetExample === null || targetExample === void 0 ? void 0 : targetExample.id)];
    setOpenKeys(keys);
  }, [currentDemo]);

  // 初始化滚动到中间
  useEffect(function () {
    if (aRef) {
      aRef.scrollIntoView({
        block: 'center',
        behavior: 'smooth'
      });
    }
  }, [aRef]);

  // 获取搜索后的文本结构 左文本 + 搜索文本 + 右文本
  var getSearchValueTitle = function getSearchValueTitle(title) {
    return searchValue && title.match(searchValue) ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("span", null, title.replace(new RegExp("".concat(searchValue, ".*")), '')), /*#__PURE__*/React.createElement("span", {
      className: styles.searchValue
    }, searchValue), /*#__PURE__*/React.createElement("span", null, title.replace(new RegExp(".*?".concat(searchValue)), ''))) : title;
  };

  // 图例按钮 + img + tooltip文本
  var renderExampleDemoCard = function renderExampleDemoCard(demo) {
    return /*#__PURE__*/React.createElement(Tooltip, {
      placement: "right",
      title: getSearchValueTitle(demo.title[locale.id] || ''),
      key: demo.id
    }, /*#__PURE__*/React.createElement("a", {
      ref: function ref(dom) {
        // TODO: DEAL WITH ME
        // if (dom && !aRef && item.value === getPath(currentExample)) {
        //   setARef(dom);
        // }
      },
      className: classNames(styles.card, _defineProperty({}, styles.current, currentDemo.id === demo.id))
    }, /*#__PURE__*/React.createElement("div", {
      className: classNames(styles.screenshot),
      style: {
        backgroundImage: "url(".concat(demo.screenshot || 'https://gw.alipayobjects.com/os/s/prod/antv/assets/image/screenshot-placeholder-b8e70.png', ")")
      },
      title: demo.title[locale.id]
    })));
  };
  var renderSubMenu = function renderSubMenu() {
    return getCurrentTopics().map(function (topic) {
      return /*#__PURE__*/React.createElement(Menu.SubMenu, {
        key: "TOPIC-".concat(topic.id),
        title: /*#__PURE__*/React.createElement("div", null, topic.icon && /*#__PURE__*/React.createElement(MenuIcon, {
          className: styles.menuIcon,
          type: "icon-".concat(topic.icon)
        }), /*#__PURE__*/React.createElement("span", {
          className: classNames(styles.menuTitleContent, styles.subMenuTitleContent)
        }, topic.title && getSearchValueTitle(topic.title[locale.id])))
      }, topic.examples.map(function (example) {
        return /*#__PURE__*/React.createElement(Menu.SubMenu, {
          key: "EXAMPLE-".concat(topic.id, "-").concat(example.id),
          title: example.title[locale.id]
        }, example.demos.map(function (demo) {
          return /*#__PURE__*/React.createElement(Menu.Item, {
            key: "DEMO-".concat(topic.id, "-").concat(example.id, "-").concat(demo.id),
            style: {
              height: 70,
              padding: 0,
              cursor: 'pointer'
            },
            onClick: function onClick() {
              onDemoClicked(_objectSpread(_objectSpread({}, demo), {}, {
                targetExample: example,
                targetTopic: topic
              }));
            }
          }, /*#__PURE__*/React.createElement("span", {
            className: styles.menuTitleContent
          }, renderExampleDemoCard(demo)));
        }));
      }));
    });
  };

  // 搜索栏
  var renderSearchBar = function renderSearchBar() {
    return /*#__PURE__*/React.createElement("div", {
      className: styles.searchSider
    }, /*#__PURE__*/React.createElement(Input, {
      size: "small",
      placeholder: intl.formatMessage({
        id: '搜索…'
      }),
      prefix: /*#__PURE__*/React.createElement(SearchOutlined, null),
      value: searchValue,
      onChange: function onChange(e) {
        return setSearchValue(e.target.value);
      }
    }), /*#__PURE__*/React.createElement(Tooltip, {
      placement: "right",
      title: /*#__PURE__*/React.createElement(FormattedMessage, {
        id: "\u6536\u8D77\u6240\u6709"
      })
    }, /*#__PURE__*/React.createElement(VerticalAlignTopOutlined, {
      className: styles.searchSiderIcon,
      onClick: function onClick() {
        return setOpenKeys([]);
      }
    })));
  };
  return /*#__PURE__*/React.createElement("div", {
    className: classNames(styles.shadowWrapper)
  }, renderSearchBar(), /*#__PURE__*/React.createElement(Menu, {
    ref: menuRef,
    mode: "inline",
    style: {
      width: '100%'
    },
    className: styles.sideBarMenu,
    openKeys: openKeys,
    selectedKeys: ["DEMO-".concat(currentDemo.id)],
    onOpenChange: function onOpenChange(keys) {
      setOpenKeys(keys);
    }
  }, renderSubMenu()));
};
export default ExampleSider;